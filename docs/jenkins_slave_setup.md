# Steps to add an agent\slave to the Jenkins server

1. Deploy a RHEL 7.x VM in Fyre.
2. Go to the Jenkins server and create a new node from an existing node such as `itc-rhel7-1.fyre.ibm.com`. Specify the host name of the newly deployed VM in fyre as the `Host`. For example `itc-rhel7-11.fyre.ibm.com`.
3. If an existing node does not exist, create a new node, and specify the information as well as the environment variables mentioned below: Host=host name of the newly deployed VM in fyre, Remote root directory=`/home/automation/jenkins`, CHROME_DRIVER=`/opt/drivers/chromedriver`, FF_DRIVER=`/opt/drivers/geckodriver`, FF_PATH=`/opt/firefox/firefox`
3. Once the node has been added, open the newly created node. A command should be available as shown below under the `Run from agent command line` section in the node page: `java -jar agent.jar -jnlpUrl https://wcp-itestcloud-jenkins.swg-devops.com/computer/vm-name-1.fyre.ibm.com/slave-agent.jnlp -secret XXXXXXXXXXX -workDir "/home/automation/jenkins"`
4. Copy the secret code from the above mentioned command and keep it in separate place for the moment. The secret code is given where the `XXXXXXXXXXX` is in the above mentioned command.
5. Downloads the following shell scripts to the newly created VM: [root_setup_fyer.sh](https://github.ibm.com/iTestCloud/com.ibm.itest.cloud.deployment/blob/master/agent-setup-scripts/root-setup-fyer.sh), [root_setup_fyer2.sh](https://github.ibm.com/iTestCloud/com.ibm.itest.cloud.deployment/blob/master/agent-setup-scripts/root-setup-fyer2.sh) and [user_setup_fyer.sh](https://github.ibm.com/iTestCloud/com.ibm.itest.cloud.deployment/blob/master/agent-setup-scripts/user-setup-fyer.sh).
6. Run the `root_setup_fyer.sh` script as the root user on the VM. If an error occurs during its execution, run the `root_setup_fyer2.sh` script instead. The particular script will configure the VM with all the required prerequisite software. When prompted by the `root_setup_fyer.sh` script, provide the host name of the VM as the `VM name` and the secret code copied in `Step 4` as the `Secret`.
7. The `root_setup_fyer.sh` script will create a local user called `automation` on the VM. Therefore, you'll be prompted for a password for this user. You may provide any password at your preference, but record it somewhere or remember it for future use.
8. Once the `root_setup_fyer.sh` script has completed, login as the `automation` user on the VM and run the `user_setup_fyer.sh` script. You'll be promoted for a password for VNC. You may provide any password at your preference, but record it somewhere or remember it for future use.
9. Confirm that you have the right version of the Chrome driver installed for the version of Chrome browser you have installed.  Chrome driver version can be verified with `/opt/drivers/chromedriver --version` and Chrome browser version with `/opt/google/chrome/chrome --version`.  This website will tell you which versions of the Chrome driver match up with which versions of the Chrome browser: https://chromedriver.chromium.org/downloads .  If you need to update the Chrome driver version , then run the script https://github.ibm.com/iTestCloud/com.ibm.itest.cloud.deployment/blob/master/agent-setup-scripts/install-chrome-driver.sh from your fyre machine and pass it the driver version as the parameter.
10. Go to the Jenkins server and verify that the newly added slave\agent is now connected and online.
